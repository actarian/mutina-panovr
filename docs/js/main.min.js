/**
 * @license mutina-panovr v1.0.0
 * (c) 2021 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("rxcomp"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define(["rxcomp","rxjs/operators","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).rxcomp,t.rxjs.operators,t.rxjs)}(this,(function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var r=function(e){function n(){return e.apply(this,arguments)||this}return o(n,e),n.prototype.onInit=function(){t.getContext(this).node.classList.remove("hidden")},n}(t.Component);r.meta={selector:"[app-component]"};var a=function(){function t(){}return t.observer=function(){var t=this;return this.observer_||(this.readySubject_=new n.BehaviorSubject(!1),this.observerSubject_=new n.Subject,this.observer_=new IntersectionObserver((function(e){t.observerSubject_.next(e)}))),this.observer_},t.intersection$=function(t){if("IntersectionObserver"in window){var i=this.observer();return i.observe(t),this.observerSubject_.pipe(e.map((function(e){return e.find((function(e){return e.target===t}))})),e.filter((function(t){return void 0!==t})),e.finalize((function(){return i.unobserve(t)})))}return n.of({target:t,isIntersecting:!0})},t.firstIntersection$=function(t){return this.intersection$(t).pipe(e.filter((function(t){return t.isIntersecting})),e.first())},t}(),s=function(n){function i(){return n.apply(this,arguments)||this}o(i,n);var r=i.prototype;return r.onInit=function(){t.getContext(this).node.classList.add("appear-stagger")},r.onChanges=function(){if(!this.appeared){this.appeared=!0;var n=t.getContext(this).node;a.firstIntersection$(n).pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.classList.add("appeared")}))}},i}(t.Directive);s.meta={selector:"[appear-stagger]"};var c=function(n){function i(){return n.apply(this,arguments)||this}o(i,n);var r=i.prototype;return r.onInit=function(){t.getContext(this).node.classList.add("appear")},r.onChanges=function(){if(!this.appeared){this.appeared=!0;var n=t.getContext(this).node;a.firstIntersection$(n).pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.classList.add("appeared")}))}},i}(t.Directive);c.meta={selector:".picture"};var u=function(i){function r(){return i.apply(this,arguments)||this}return o(r,i),r.prototype.onInit=function(){var i=this;this.initialFocus=!1;var o=t.getContext(this),r=o.module,a=o.node,s=o.parentInstance,c=(o.selector,this.event$=n.fromEvent(document,"click").pipe(e.filter((function(t){var e=t.target;if(a.contains(e)||!document.contains(e))i.initialFocus=!0;else if(i.initialFocus)return i.initialFocus=!1,!0})),e.shareReplay(1))),u=a.getAttribute("(clickOutside)");if(u){var l=r.makeFunction(u,["$event"]);c.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(l,s,t)}))}else s.clickOutside$=c},r}(t.Directive);u.meta={selector:"[(clickOutside)]"};var l=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.transform=function(t){if(t){t=t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e))}));var e=['"',"&","'","<",">"," ","¡","¢","£","¤","¥","¦","§","¨","©","ª","«","¬","­","®","¯","°","±","²","³","´","µ","¶","·","¸","¹","º","»","¼","½","¾","¿","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ð","Ñ","Ò","Ó","Ô","Õ","Ö","×","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","÷","ø","ù","ú","û","ü","ý","þ","ÿ","&","•","°","∞","‰","⋅","±","†","—","¬","µ","⊥","∥","€","£","¥","¢","©","®","™","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],n=new RegExp("(&"+["quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","amp","bull","deg","infin","permil","sdot","plusmn","dagger","mdash","not","micro","perp","par","euro","pound","yen","cent","copy","reg","trade","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"].join(";)|(&")+";)","g");return t=t.replace(n,(function(){for(var t=1;t<arguments.length;t++)if(arguments[t])return e[t-1]}))}},e}(t.Pipe);l.meta={name:"html"};var d=function(t){this.data=t},p=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(d),h=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(d),f=function(){function t(){}return t.open$=function(t){var n=this;return this.getTemplate$(t.src).pipe(e.map((function(e){return{node:n.getNode(e),data:t.data,modal:t}})),e.tap((function(t){return n.modal$.next(t)})),e.switchMap((function(t){return n.events$})))},t.load$=function(t){},t.getTemplate$=function(t){return n.from(fetch(t).then((function(t){return t.text()})))},t.getNode=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild},t.reject=function(t){this.modal$.next(null),this.events$.next(new h(t))},t.resolve=function(t){this.modal$.next(null),this.events$.next(new p(t))},t}();f.modal$=new n.Subject,f.events$=new n.Subject;var v=function(n){function r(){return n.apply(this,arguments)||this}o(r,n);var a,s,c,u=r.prototype;return u.onInit=function(){var n=this,i=t.getContext(this).node;this.modalNode=i.querySelector(".modal-outlet__modal"),f.modal$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.modal=t}))},u.onRegister=function(t){this.pushChanges()},u.onLogin=function(t){this.pushChanges()},u.reject=function(t){f.reject()},a=r,(s=[{key:"modal",get:function(){return this.modal_},set:function(e){var n=t.getContext(this).module;this.modal_&&this.modal_.node&&(n.remove(this.modal_.node,this),this.modalNode.removeChild(this.modal_.node)),e&&e.node&&(this.modal_=e,this.modalNode.appendChild(e.node),n.compile(e.node)),this.modal_=e,this.pushChanges()}}])&&i(a.prototype,s),c&&i(a,c),r}(t.Component);v.meta={selector:"[modal-outlet]",template:'\n\t<div class="modal-outlet__container" [class]="{ active: modal }">\n\t\t<div class="modal-outlet__background" (click)="reject($event)"></div>\n\t\t<div class="modal-outlet__modal"></div>\n\t</div>\n\t'};var m=function(e){function n(){return e.apply(this,arguments)||this}o(n,e);var i=n.prototype;return i.onInit=function(){var e=t.getContext(this).parentInstance;e instanceof v&&(this.data=e.modal.data)},i.close=function(){f.reject()},n}(t.Component);m.meta={selector:"[modal]"};var g=0,b={},C=function(i){function r(){return i.apply(this,arguments)||this}o(r,i),r.onClickedPin=function(t,e){Object.keys(b).forEach((function(n){if(t===parseInt(n)){var i=b[n];i.onClickedPin.call(i,e)}}))},r.register=function(t,e){b[t]=e},r.unregister=function(t){delete b[t]};var a=r.prototype;return a.getNode=function(){return t.getContext(this).node},a.onInit=function(){var t=this,n=this.uid=++g;r.register(n,this),this.items=[],this.item=null,this.load$().pipe(e.first()).subscribe((function(e){t.items=e,t.loadPanoVr()}))},a.onDestroy=function(){r.unregister(uid)},a.load$=function(){return n.of([{id:1,title:"End Piece L",abstract:"Black painted metal on dark oak",image:"/mutina-panovr/img/panovr/end-piece-l.jpg",link:{url:"#",title:"Accents Wood Collection"}},{id:2,title:"End Piece L 2",abstract:"Black painted metal on dark oak",image:"/mutina-panovr/img/panovr/end-piece-l.jpg",link:{url:"#",title:"Accents Wood Collection"}},{id:3,title:"End Piece L 3",abstract:"Black painted metal on dark oak",image:"/mutina-panovr/img/panovr/end-piece-l.jpg",link:{url:"#",title:"Accents Wood Collection"}}])},a.loadPanoVr=function(){var t=this,e=this.getNode(),n="panovr-"+this.uid,i=e.querySelector(".panovr__inner");i.setAttribute("id",n),console.log(i);var o=this.pano=new pano2vrPlayer(n);new pano2vrSkin(o);o.setBasePath(this.getBasePath(this.panovr)),this.loadPanoVR(this.panovr,(function(e){t.parsePanoVRString(e)}))},a.getBasePath=function(t){var e=t.split("/");return e.pop(),e.join("/")+"/"},a.loadPanoVR=function(t,e){var n=new XMLHttpRequest;n.onload=function(){"function"==typeof e&&e(this.responseText)},n.open("GET",t),n.send()},a.parsePanoVRString=function(t){t=t.replace(/javascript\:onClickedPin\(/g,"javascript:onClickedPin("+this.uid+","),this.pano.readConfigString(t),this.initPanoVR()},a.loadPanoVRXML=function(t,e){var n=new XMLHttpRequest;n.onload=function(){"function"==typeof e&&e(this.responseXML)},n.open("GET",t),n.send()},a.parsePanoVRXML=function(t){this.pano.readConfigXml(t),this.initPanoVR()},a.readPanoVRXML=function(t){this.pano.readConfigUrl(t),this.initPanoVR()},a.initPanoVR=function(){var t=this,e=this.pano;e.getNodeIds();e.getPointHotspotIds().forEach((function(t){var n=e.getHotspot(t);-1!==n.url.indexOf("onClickedPin")&&(n.url="javascript:alert('pippo');")})),e.on("repaint",(function(e){t.onRepaint(e)})),this.onClickOutside=this.onClickOutside.bind(this),document.addEventListener("click",this.onClickOutside)},a.onClickOutside=function(t){var e=this.getNode().querySelector(".panovr-toast");r.isChildOfNode(t.target,e)||(this.index=null,this.item=null,this.removeToast(),this.pushChanges())},r.isChildOfNode=function(t,e){return!(!t||!e)&&(t===e||!!t.parentNode&&this.isChildOfNode(t.parentNode,e))},a.onClickedPin=function(t){this.index=t,this.item=this.items[t],this.addToast(this.item),this.pin.next(t),this.onRepaint()},a.addToast=function(t){this.removeToast();var e='\n\t\t<div class="panovr-toast">\n\t\t\t<div class="panovr-toast__content">\n\t\t\t\t<div class="panovr-toast__title">'+t.title+'</div>\n\t\t\t\t<div class="panovr-toast__abstract">'+t.abstract+'</div>\n\t\t\t\t<div class="panovr-toast__group-cta">\n\t\t\t\t\t<a class="panovr-toast__cta" href="'+t.link.url+'">'+t.link.title+'</a>\n\t\t\t\t\t<a class="panovr-toast__cta">Add to samples</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="panovr-toast__picture">\n\t\t\t\t<img src="'+t.image+'" />\n\t\t\t</div>\n\t\t\t\x3c!-- <div class="panovr-toast__close" (click)="onToastClose($event)">x</div> --\x3e\n\t\t</div>\n\t\t',n=this.getNode(),i=document.createElement("div");i.innerHTML=e,n.appendChild(i.firstElementChild)},a.removeToast=function(){var t=this.getNode().querySelector(".panovr-toast");t&&t.parentElement.removeChild(t)},a.onRepaint=function(){var t=this,e=this.index;if(null!=e){var n=this.getNode(),i=n.querySelector(".panovr-toast");if(i){var o=this.pano,r=o.getPointHotspotIds().map((function(t){return o.getHotspot(t)})).find((function(n){return n.url==="javascript:onClickedPin("+t.uid+","+e+");"})),a=0,s=0;if(r){var c=n.getBoundingClientRect(),u=r.div.getBoundingClientRect();a=u.x-c.x,s=u.y-c.y;var l=a/c.width,d=s/c.height,p=Math.floor(3*l)-1,h=Math.floor(3*d)-1;i.classList.remove("left","right","top","bottom");var f=a,v=s,m=i.offsetWidth,g=i.offsetHeight,b=30,C=30;p<0?h<0?(f=a+b,v=s+C):0===h?(f=a+b,v=s-g/2,i.classList.add("left")):h>0&&(f=a+b,v=s-C-g):0===p?h<0||0===h?(f=a-m/2,v=s+C,i.classList.add("top")):h>0&&(f=a-m/2,v=s-C-g,i.classList.add("bottom")):p>0&&(h<0?(f=a-b-m,v=s+C):0===h?(f=a-b-m,v=s-g/2,i.classList.add("right")):h>0&&(f=a-b-m,v=s-C-g)),i.style.position="absolute",i.style.left=f+"px",i.style.top=v+"px"}}}},a.onToastClose=function(t){this.item=null,this.pushChanges()},r}(t.Component);C.meta={selector:"[panovr]",outputs:["pin"],inputs:["panovr"]},window.onClickedPin=C.onClickedPin;var y=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(t.Module);y.meta={imports:[t.CoreModule],declarations:[c,s,u,l,m,v,C],bootstrap:r},t.Browser.bootstrap(y)}));
//# sourceMappingURL=main.min.js.map