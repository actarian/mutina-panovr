/**
 * @license mutina-panovr v1.0.0
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("rxcomp"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define(["rxcomp","rxjs/operators","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).rxcomp,t.rxjs.operators,t.rxjs)}(this,(function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var r=function(e){function n(){return e.apply(this,arguments)||this}return o(n,e),n.prototype.onInit=function(){t.getContext(this).node.classList.remove("hidden")},n}(t.Component);r.meta={selector:"[app-component]"};var a=function(){function t(){}return t.observer=function(){var t=this;return this.observer_||(this.readySubject_=new n.BehaviorSubject(!1),this.observerSubject_=new n.Subject,this.observer_=new IntersectionObserver((function(e){t.observerSubject_.next(e)}))),this.observer_},t.intersection$=function(t){if("IntersectionObserver"in window){var i=this.observer();return i.observe(t),this.observerSubject_.pipe(e.map((function(e){return e.find((function(e){return e.target===t}))})),e.filter((function(t){return void 0!==t})),e.finalize((function(){return i.unobserve(t)})))}return n.of({target:t,isIntersecting:!0})},t.firstIntersection$=function(t){return this.intersection$(t).pipe(e.filter((function(t){return t.isIntersecting})),e.first())},t}(),s=function(n){function i(){return n.apply(this,arguments)||this}o(i,n);var r=i.prototype;return r.onInit=function(){t.getContext(this).node.classList.add("appear-stagger")},r.onChanges=function(){if(!this.appeared){this.appeared=!0;var n=t.getContext(this).node;a.firstIntersection$(n).pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.classList.add("appeared")}))}},i}(t.Directive);s.meta={selector:"[appear-stagger]"};var u=function(n){function i(){return n.apply(this,arguments)||this}o(i,n);var r=i.prototype;return r.onInit=function(){t.getContext(this).node.classList.add("appear")},r.onChanges=function(){if(!this.appeared){this.appeared=!0;var n=t.getContext(this).node;a.firstIntersection$(n).pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.classList.add("appeared")}))}},i}(t.Directive);u.meta={selector:".picture"};var c=function(i){function r(){return i.apply(this,arguments)||this}return o(r,i),r.prototype.onInit=function(){var i=this;this.initialFocus=!1;var o=t.getContext(this),r=o.module,a=o.node,s=o.parentInstance,u=(o.selector,this.event$=n.fromEvent(document,"click").pipe(e.filter((function(t){var e=t.target;if(a.contains(e)||!document.contains(e))i.initialFocus=!0;else if(i.initialFocus)return i.initialFocus=!1,!0})),e.shareReplay(1))),c=a.getAttribute("(clickOutside)");if(c){var l=r.makeFunction(c,["$event"]);u.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(l,s,t)}))}else s.clickOutside$=u},r}(t.Directive);c.meta={selector:"[(clickOutside)]"};var l=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.transform=function(t){if(t){t=t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e))}));var e=['"',"&","'","<",">"," ","¡","¢","£","¤","¥","¦","§","¨","©","ª","«","¬","­","®","¯","°","±","²","³","´","µ","¶","·","¸","¹","º","»","¼","½","¾","¿","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ð","Ñ","Ò","Ó","Ô","Õ","Ö","×","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","÷","ø","ù","ú","û","ü","ý","þ","ÿ","&","•","°","∞","‰","⋅","±","†","—","¬","µ","⊥","∥","€","£","¥","¢","©","®","™","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],n=new RegExp("(&"+["quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","amp","bull","deg","infin","permil","sdot","plusmn","dagger","mdash","not","micro","perp","par","euro","pound","yen","cent","copy","reg","trade","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"].join(";)|(&")+";)","g");return t=t.replace(n,(function(){for(var t=1;t<arguments.length;t++)if(arguments[t])return e[t-1]}))}},e}(t.Pipe);l.meta={name:"html"};var p=function(t){this.data=t},d=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(p),h=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(p),f=function(){function t(){}return t.open$=function(t){var n=this;return this.getTemplate$(t.src).pipe(e.map((function(e){return{node:n.getNode(e),data:t.data,modal:t}})),e.tap((function(t){return n.modal$.next(t)})),e.switchMap((function(t){return n.events$})))},t.load$=function(t){},t.getTemplate$=function(t){return n.from(fetch(t).then((function(t){return t.text()})))},t.getNode=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild},t.reject=function(t){this.modal$.next(null),this.events$.next(new h(t))},t.resolve=function(t){this.modal$.next(null),this.events$.next(new d(t))},t}();f.modal$=new n.Subject,f.events$=new n.Subject;var m=function(n){function r(){return n.apply(this,arguments)||this}o(r,n);var a,s,u,c=r.prototype;return c.onInit=function(){var n=this,i=t.getContext(this).node;this.modalNode=i.querySelector(".modal-outlet__modal"),f.modal$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.modal=t}))},c.onRegister=function(t){this.pushChanges()},c.onLogin=function(t){this.pushChanges()},c.reject=function(t){f.reject()},a=r,(s=[{key:"modal",get:function(){return this.modal_},set:function(e){var n=t.getContext(this).module;this.modal_&&this.modal_.node&&(n.remove(this.modal_.node,this),this.modalNode.removeChild(this.modal_.node)),e&&e.node&&(this.modal_=e,this.modalNode.appendChild(e.node),n.compile(e.node)),this.modal_=e,this.pushChanges()}}])&&i(a.prototype,s),u&&i(a,u),r}(t.Component);m.meta={selector:"[modal-outlet]",template:'\n\t<div class="modal-outlet__container" [class]="{ active: modal }">\n\t\t<div class="modal-outlet__background" (click)="reject($event)"></div>\n\t\t<div class="modal-outlet__modal"></div>\n\t</div>\n\t'};var v=function(e){function n(){return e.apply(this,arguments)||this}o(n,e);var i=n.prototype;return i.onInit=function(){var e=t.getContext(this).parentInstance;e instanceof m&&(this.data=e.modal.data)},i.close=function(){f.reject()},n}(t.Component);v.meta={selector:"[modal]"};var g=0,b={},C=function(i){function r(){return i.apply(this,arguments)||this}o(r,i),r.onClickedPin=function(t,e){Object.keys(b).forEach((function(n){if(t===parseInt(n)){var i=b[n];i.onClickedPin.call(i,e)}}))},r.register=function(t,e){b[t]=e},r.unregister=function(t){delete b[t]};var a=r.prototype;return a.onInit=function(){var t=this,n=this.uid=++g;r.register(n,this),this.items=[],this.item=null,this.load$().pipe(e.first()).subscribe((function(e){t.items=e,t.loadPanoVr()}))},a.onDestroy=function(){r.unregister(uid)},a.load$=function(){return n.of([{title:"Title 01",abstract:"abstract 01"},{title:"Title 02",abstract:"abstract 02"},{title:"Title 03",abstract:"abstract 03"}])},a.loadPanoVr=function(){var e=this,n=t.getContext(this).node.querySelector(".inner"),i="panovr-"+this.uid;n.setAttribute("id",i);var o=this.pano=new pano2vrPlayer(i);new pano2vrSkin(o);o.setBasePath(this.getBasePath(this.panovr)),this.loadPanoVR(this.panovr,(function(t){e.parsePanoVRString(t)}))},a.getBasePath=function(t){var e=t.split("/");return e.pop(),e.join("/")+"/"},a.loadPanoVR=function(t,e){var n=new XMLHttpRequest;n.onload=function(){"function"==typeof e&&e(this.responseText)},n.open("GET",t),n.send()},a.parsePanoVRString=function(t){t=t.replace(/javascript\:onClickedPin\(/g,"javascript:onClickedPin("+this.uid+","),this.pano.readConfigString(t),this.initPanoVR()},a.loadPanoVRXML=function(t,e){var n=new XMLHttpRequest;n.onload=function(){"function"==typeof e&&e(this.responseXML)},n.open("GET",t),n.send()},a.parsePanoVRXML=function(t){this.pano.readConfigXml(t),this.initPanoVR()},a.readPanoVRXML=function(t){this.pano.readConfigUrl(t),this.initPanoVR()},a.initPanoVR=function(){var t=this,e=this.pano;e.getNodeIds();e.getPointHotspotIds().forEach((function(t){var n=e.getHotspot(t);-1!==n.url.indexOf("onClickedPin")&&(n.url="javascript:alert('pippo');")})),e.on("repaint",(function(e){t.onRepaint(e)})),this.onClickOutside=this.onClickOutside.bind(this),document.addEventListener("click",this.onClickOutside)},a.onClickOutside=function(e){var n=t.getContext(this).node.querySelector(".toast");r.isChildOfNode(e.target,n)||(this.index=null,this.item=null,this.pushChanges())},r.isChildOfNode=function(t,e){return!(!t||!e)&&(t===e||!!t.parentNode&&this.isChildOfNode(t.parentNode,e))},a.onClickedPin=function(t){this.index=t,this.item=this.items[t],this.pushChanges(),this.pin.next(t),this.onRepaint()},a.onRepaint=function(){var e=this,n=this.index;if(null!=n){var i=t.getContext(this).node,o=i.querySelector(".toast");if(o){var r=this.pano,a=r.getPointHotspotIds().map((function(t){return r.getHotspot(t)})).find((function(t){return t.url==="javascript:onClickedPin("+e.uid+","+n+");"})),s=0,u=0;if(a){var c=i.getBoundingClientRect(),l=a.div.getBoundingClientRect();s=l.x-c.x,u=l.y-c.y;var p=s/c.width,d=u/c.height,h=Math.floor(3*p)-1,f=Math.floor(3*d)-1;o.classList.remove("left","right","top","bottom");var m=s,v=u,g=o.offsetWidth,b=o.offsetHeight,C=20,y=20;h<0?f<0?(m=s+C,v=u+y):0===f?(m=s+C,v=u-b/2,o.classList.add("left")):f>0&&(m=s+C,v=u-y-b):0===h?f<0||0===f?(m=s-g/2,v=u+y,o.classList.add("top")):f>0&&(m=s-g/2,v=u-y-b,o.classList.add("bottom")):h>0&&(f<0?(m=s-C-g,v=u+y):0===f?(m=s-C-g,v=u-b/2,o.classList.add("right")):f>0&&(m=s-C-g,v=u-y-b)),o.style.position="absolute",o.style.left=m+"px",o.style.top=v+"px"}}}},a.onToastClose=function(t){this.item=null,this.pushChanges()},r}(t.Component);C.meta={selector:"[panovr]",outputs:["pin"],inputs:["panovr"]},window.onClickedPin=C.onClickedPin;var y=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(t.Module);y.meta={imports:[t.CoreModule],declarations:[u,s,c,l,v,m,C],bootstrap:r},t.Browser.bootstrap(y)}));
//# sourceMappingURL=main.min.js.map